(function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;!function(window,$){var DateRangePicker,DateRangePickerBase,DayView,MonthView,Pingdom;return Pingdom=window.Pingdom=window.Pingdom||{},DateRangePickerBase=function(){function DateRangePickerBase(options){this.evtIdentifier="pd-datepicker",this.defaultOptions||(this.defaultOptions={}),this.options=$.extend(this.defaultOptions,options),this.initialize.apply(this,arguments)}return DateRangePickerBase.prototype.initialize=function(){},DateRangePickerBase.prototype.getWeekDay=function(date){var day;return day=date.get("day"),0===day?6:1===day?0:day-1},DateRangePickerBase.prototype.getToday=function(){return moment.tz(this.options.timezone).startOf("day")},DateRangePickerBase}(),DayView=function(superClass){function DayView(){return DayView.__super__.constructor.apply(this,arguments)}return extend(DayView,superClass),DayView.prototype.initialize=function(options,date1){return this.date=date1,this.date?(Pingdom.component.add(this,["Event"]),this.enabled=this.date.unix()<=this.getToday().unix(),this.enabled&&options.min&&(this.enabled=this.date>=options.min),this.id="d:"+this.date.format("YYYY:MM:DD"),this.render(),this.el=this.$el[0],this.$el.on("click."+this.evtIdentifier,function(_this){return function(evt){return _this.enabled?(_this.$el.css("transform","scale(1.5)"),_this.$el.css("z-index",3),setTimeout(function(){return _this.$el.css("transform","scale(1)"),setTimeout(function(){return _this.$el.css("z-index","auto")},100)},100),_this.trigger("click."+_this.evtIdentifier,_this.date)):void 0}}(this)),this):void 0},DayView.prototype.render=function(){return this.$el=$(document.createElement("div")).addClass("datepicker-day"),this.date===this.getToday()&&this.$el.addClass("datepicker-day-today"),this.enabled?this.$el.addClass("datepicker-day-enabled"):this.$el.addClass("datepicker-day-disabled"),this.$el.html(this.date.get("date")),this},DayView.prototype.select=function(){return this.enabled?(this.$el.addClass("datepicker-day-selected"),this.trigger("selected",this),this):void 0},DayView.prototype.deselect=function(){return this.$el.removeClass("datepicker-day-selected"),this.trigger("deselected",this),this},DayView}(DateRangePickerBase),MonthView=function(superClass){function MonthView(){this.defaultOptions={days:["Mo","Tu","We","Th","Fr","Sa","Su"],months:["January","February","March","April","May","June","July","August","September","October","November","December"]},MonthView.__super__.constructor.apply(this,arguments)}return extend(MonthView,superClass),MonthView.prototype.initialize=function(options,date1){return this.date=date1,this.date?(Pingdom.component.add(this,["Event"]),this.id="m:"+this.date.format("YYYY:MM"),this.dayViews=[],this.$el=$(document.createElement("div")).addClass("datepicker-month"),this.render(),this.el=this.$el[0],this):void 0},MonthView.prototype.render=function(){var cell,dayOptions,dayView,days,daysOffset,exceedingDays,i,index,j,k,l,len,m,month,n,precedingDate,ref,ref1,ref2,row,title,week,weekDay,weekDays,weekDaysOffset;for(days=this.getDaysInMonth(this.date.get("month"),this.date.get("year")),title=$(document.createElement("div")).addClass("datepicker-month-title"),month=this.options.months[this.date.get("month")]?this.options.months[this.date.get("month")]:this.defaultOptions.months[this.date.get("month")],title.html(month+", "+this.date.get("year")),this.$el.append(title),row=$(document.createElement("div")).addClass("datepicker-week-title"),index=j=0;7>j;index=j+=1)cell=$(document.createElement("div")).addClass("datepicker-day-title"),cell.html(this.options.days[index]?this.options.days[index]:this.defaultOptions.days[index]),row.append(cell);for(this.$el.append(row),exceedingDays=0,daysOffset=this.getWeekDay(days[0]),week=k=0;6>k;week=k+=1){for(row=$(document.createElement("div")).addClass("datepicker-week"),weekDays=days.slice(Math.max(0,7*week-daysOffset),7*week+7-daysOffset),weekDaysOffset=weekDays[0]?this.getWeekDay(weekDays[0]):0,i=l=ref=weekDaysOffset;l>0;i=l+=-1)precedingDate=days[0].clone().subtract(i,"days"),cell=$(document.createElement("div")).addClass("datepicker-day datepicker-day-preceding"),cell.html(precedingDate.get("date")),row.append(cell);for(m=0,len=weekDays.length;len>m;m++)weekDay=weekDays[m],dayOptions={min:this.options.min,timezone:this.options.timezone},dayView=new DayView(dayOptions,weekDay),this.addDayEventListeners(dayView),this.dayViews.push(dayView),row.append(dayView.$el);if(week>0&&weekDays.length<7){for(i=n=ref1=exceedingDays,ref2=exceedingDays+7-weekDays.length;ref2>n;i=n+=1)cell=$(document.createElement("div")).addClass("datepicker-day datepicker-day-exceeding"),cell.html(i+1),row.append(cell);exceedingDays+=7-weekDays.length}this.$el.append(row)}return this},MonthView.prototype.select=function(start,end){var dayView,j,len,ref,toEndOfDay;if(toEndOfDay=86399,start&&end)for(ref=this.dayViews,j=0,len=ref.length;len>j;j++)dayView=ref[j],start.unix()<=dayView.date.unix()+toEndOfDay&&dayView.date.unix()<=end.unix()?dayView.select():dayView.deselect();return this},MonthView.prototype.addDayEventListeners=function(dayView){return dayView.off("click."+this.evtIdentifier).on("click."+this.evtIdentifier,function(_this){return function(date){return _this.trigger("click."+_this.evtIdentifier,date)}}(this))},MonthView.prototype.getDaysInMonth=function(month,year){var date,days;for(void 0===month&&(month=this.date.get("month")),void 0===year&&(year=this.date.get("year")),days=[],date=moment.tz({year:year,month:month},this.options.timezone);date.get("month")===month;)days.push(date.clone()),date.add(1,"days");return days},MonthView}(DateRangePickerBase),Pingdom.DateRangePicker2=DateRangePicker=function(superClass){function DateRangePicker(){this.defaultOptions={element:null,transition:300,start:void 0,end:void 0,min:null,max:null,maxRange:null,mode:"range"},DateRangePicker.__super__.constructor.apply(this,arguments)}return extend(DateRangePicker,superClass),DateRangePicker.prototype.initialize=function(options){var endDate,resizeThrottled,selectionChangeThrottled,startDate,tmpTransition;return Pingdom.component.add(this,["Event"]),selectionChangeThrottled=_.throttle(this.onSelectionChanged,100).bind(this),this.on("change",selectionChangeThrottled),resizeThrottled=_.throttle(function(){return this.setTransition(0),this.currentDate&&this.focus(this.currentDate),setTimeout(function(_this){return function(){return _this.setTransition(_this.options.transition)}}(this),1)},250).bind(this),$(window).on("resize",resizeThrottled),this.monthViews=[],this.startDate=void 0,this.endDate=void 0,this.$el=$(this.options.element).addClass("pd-daterangepicker"),this.el=this.$el[0],this.$months=$(document.createElement("div")).addClass("pd-datepicker-months"),$(this.$el).append(this.$months),this.$el.append('<div class="pd-datepicker-nav-left"><div class="pd-datepicker-nav-icon icon-arrow-left"></div></div>\n<div class="pd-datepicker-nav-right"><div class="pd-datepicker-nav-icon icon-arrow-right"></div></div>\n<input type="hidden" name="daterangepicker-start" value="">\n<input type="hidden" name="daterangepicker-end" value="">'),startDate=this.options.start?this.options.start:this.getToday(),endDate=this.options.end?this.options.end:startDate.clone().add(1,"days"),this.addMonthView(startDate),tmpTransition=this.options.transition,this.setTransition(this.options.transition=0),this.focus(moment.tz((startDate.unix()+endDate.unix())/2,"X",this.options.timezone)),this.addEventListeners(),this.setTransition(this.options.transition=tmpTransition),this.options.start&&this.selectRange(startDate,endDate),this},DateRangePicker.prototype.addMonthView=function(date){var index,monthOptions,monthView;return date=moment.tz({year:date.get("year"),month:date.get("month")},this.options.timezone),null!==this.getMonthViewIndex(date)?this:(monthOptions={container:this.$months},monthView=new MonthView($.extend(this.options,monthOptions),date),this.addMonthEventListerns(monthView),this.monthViews.push(monthView),monthView.select(this.startDate,this.endDate),this.monthViews.sort(function(a,b){return a.date.unix()-b.date.unix()}),index=this.getMonthViewIndex(date),0===index?this.$months.prepend(monthView.$el):$(this.$months.find(".datepicker-month").get(index-1)).after(monthView.$el),this.currentDate&&this.focus(this.currentDate),this)},DateRangePicker.prototype.getMonthView=function(date){return thismonthViews[this.getMonthViewIndex(date)]},DateRangePicker.prototype.getMonthViewIndex=function(date){var i,j,len,monthView,ref;for(date=moment(date),ref=this.monthViews,i=j=0,len=ref.length;len>j;i=++j)if(monthView=ref[i],monthView.date.get("year")===date.get("year")&&monthView.date.get("month")===date.get("month"))return i;return null},DateRangePicker.prototype.addMonthEventListerns=function(monthView){return this._selectToggle="start",monthView.off("click."+this.evtIdentifier).on("click."+this.evtIdentifier,function(_this){return function(date){return"start"===_this._selectToggle?(_this.selectStart(date,!1),_this.selectEnd(date.clone().add(1,"seconds"),!1),_this.trigger("change:start"),_this.trigger("change:start-manual"),"single"!==_this.options.mode?_this._selectToggle="end":(_this.trigger("change:end",{start:_this.startDate,end:_this.endDate}),_this.trigger("change:selection",{start:_this.startDate,end:_this.endDate}))):(_this.selectEnd(date),_this._selectToggle="start",_this.trigger("change:end",{start:_this.startDate,end:_this.endDate}),_this.trigger("change:selection",{start:_this.startDate,end:_this.endDate})),_this.trigger("change",{start:_this.startDate,end:_this.endDate})}}(this)),this},DateRangePicker.prototype.addEventListeners=function(){return this.$el.find(".pd-datepicker-nav-right").on("click."+this.evtIdentifier,function(_this){return function(evt){return evt.preventDefault(),_this.focusNextMonth()}}(this)),this.$el.find(".pd-datepicker-nav-left").on("click."+this.evtIdentifier,function(_this){return function(evt){return evt.preventDefault(),_this.focusPrevMonth()}}(this)),this},DateRangePicker.prototype.focus=function(date,transition){var focusIndex,focusMonthView,j,len,margin,newContainerPos,nextMonth,posX,prevMonth,ref,rule,width;if(null==transition&&(transition=null),focusIndex=this.getMonthViewIndex(date),focusMonthView=this.monthViews[focusIndex]){if(focusMonthView.date.get("year")>=this.getToday().get("year")&&focusMonthView.date.get("month")>this.getToday().get("month"))return this;for(this.currentDate=date,margin=0,ref=["left","right"],j=0,len=ref.length;len>j;j++)rule=ref[j],margin+=parseInt(focusMonthView.$el.css("margin-"+rule).replace("px",""),10);return width=focusMonthView.$el.outerWidth()+margin,posX=width*focusIndex,newContainerPos=Math.floor(this.$months.width()/2-posX-width/2),2*newContainerPos>width&&(prevMonth=this.monthViews[0].date.clone().subtract(1,"months"),null===this.getMonthViewIndex(prevMonth))?(this.setFocusPosition(newContainerPos-2*width,0),this.addMonthView(prevMonth),this):2*(this.$months.width()-(this.monthViews.length*width+newContainerPos))>width&&(nextMonth=this.monthViews[this.monthViews.length-1].date.clone().add(1,"months"),null===this.getMonthViewIndex(nextMonth))?(this.addMonthView(nextMonth),this):(null===transition&&(transition=this.options.transition),this.setFocusPosition(newContainerPos,transition),this)}},DateRangePicker.prototype.setFocusPosition=function(pos,transition){return this.focusThrottle||(this.focusThrottle=_.throttle(function(pos,transition){var transformName;return void 0===transition&&(transition=this.options.transition),this.setTransition(transition),transformName="undefined"!=typeof Modernizr&&null!==Modernizr&&"function"==typeof Modernizr.prefixed?Modernizr.prefixed("transform"):void 0,transformName?this.$months.get(0).style[transformName]="translate("+pos+"px, 0)":this.$months.get(0).style.left=pos+"px",this.$months[0].offsetHeight},1).bind(this)),this.focusThrottle(pos,transition)},DateRangePicker.prototype.focusNextMonth=function(){var nextMonth;return nextMonth=this.currentDate.clone().add(1,"months"),this.focus(nextMonth),this},DateRangePicker.prototype.focusPrevMonth=function(){var prevMonth;return prevMonth=this.currentDate.clone().subtract(1,"months"),this.focus(prevMonth),this},DateRangePicker.prototype.selectRange=function(startDate,endDate,triggerChange){return null==triggerChange&&(triggerChange=!1),startDate&&this.selectStart(startDate,triggerChange),endDate&&this.selectEnd(endDate,triggerChange),this.trigger("change:start",{start:this.startDate,end:this.endDate}),this.trigger("change:end",{start:this.startDate,end:this.endDate}),this.trigger("change",{start:this.startDate,end:this.endDate}),this},DateRangePicker.prototype.selectStart=function(startDate,triggerChange){return null==triggerChange&&(triggerChange=!0),startDate?(this.startDate=startDate=moment(startDate),triggerChange&&(this.trigger("change:start",{start:this.startDate,end:this.endDate}),this.trigger("change",{start:this.startDate,end:this.endDate})),this):void 0},DateRangePicker.prototype.selectEnd=function(endDate,triggerChange){var diffDays,oneDay;return null==triggerChange&&(triggerChange=!0),endDate?(endDate=moment(endDate),endDate.unix()<this.startDate.unix()?(this.selectRange(endDate,this.startDate,triggerChange),this):(triggerChange&&(endDate=endDate.clone().endOf("day")),oneDay=86400,diffDays=Math.round(Math.abs((endDate.unix()-this.startDate.unix())/oneDay)),this.options.maxRange&&diffDays>this.options.maxRange&&(endDate=this.startDate.clone().add(this.options.maxRange,"days")),this.endDate=endDate,triggerChange&&(this.trigger("change:end",{start:this.startDate,end:this.endDate}),this.trigger("change",{start:this.startDate,end:this.endDate})),this)):void 0},DateRangePicker.prototype.onSelectionChanged=function(){var from,j,len,monthView,ref;for(from=this.startDate.clone();;)if(null===this.getMonthViewIndex(from)&&this.addMonthView(from),from.add(1,"months"),from.unix()>=this.endDate.unix())break;for(this.$el.find(".datepicker-day-selected").removeClass(".datepicker-day-selected"),this.startDate&&this.$el.find('input[name="daterangepicker-start"]').val(this.startDate.format("YYYY-MM-DD")),this.endDate&&this.$el.find('input[name="daterangepicker-end"]').val(this.endDate.format("YYYY-MM-DD")),ref=this.monthViews,j=0,len=ref.length;len>j;j++)monthView=ref[j],monthView.select(this.startDate,this.endDate);return this.$el.trigger("change",[this.startDate,this.endDate])},DateRangePicker.prototype.setTransition=function(ms){var transitionCss;return transitionCss=["-webkit-transition","-moz-transition","transition"],this.$months.css(function(ms){var i,result;for(result={},i=0;i<transitionCss.length;)result[transitionCss[i]]="transform "+ms+"ms ease",i++;return result}.bind(this)(ms)),this},DateRangePicker}(DateRangePickerBase),$.fn.dateRangePicker=function(options){var dateRangePicker;return null==options&&(options={}),this.data("hasDateRangePicker")?this:(options.element=this,dateRangePicker=new DateRangePicker(options),this.drp=dateRangePicker,this.data("hasDateRangePicker",!0),this)}}(window,jQuery)}).call(this);